try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="aa277482-7968-4c1d-a426-47c97804892e",e._sentryDebugIdIdentifier="sentry-dbid-aa277482-7968-4c1d-a426-47c97804892e")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:scheduling-links":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3728],{28539:(e,t,r)=>{r.d(t,{r:()=>i});let n={ChiliForm:"ProcessedChiliFormTrigger",ThirdPartyForm:"ProcessedThirdPartyFormTrigger",InAppButton:"ProcessedInAppButtonTrigger",RouterLink:"ProcessedRouterLinkTrigger",RestAPI:"ProcessedInAppButtonTrigger"},i=(e,t="ThirdPartyForm")=>e&&"ConciergeFormMappingProcessedV1"!==e.type?e.get.filter(e=>e.type===n[t]).map(e=>e.mapping).flat():[]},33903:(e,t,r)=>{r.d(t,{DR:()=>l,Jp:()=>d,l0:()=>u});var n=r(44966),i=r(57403),a=r.n(i),o=r(20350),s=r.n(o);let u=(e,t)=>{let r=new URL((0,n.l2)(e.url));return t&&e.forwardFormDataAsQueryParams?`${r}${r.search?"&":"?"}${t.toString()}`:r.toString()},d=e=>{let t=new URLSearchParams({trigger:e.trigger});return["locale","meetingTypeId","closeOnOutside","domElement","concierge","attendees","guestEmail","dynamicRedirectLink"].forEach(r=>{r in e&&void 0!==e[r]&&t.set(r,String(e[r]))}),`/concierge-router/${e.routerSlug}/routing/${e.routingId}?${t.toString()}${e.fieldParams?`&${e.fieldParams}`:""}`},l=({availabilityOptions:e,additionalAttendees:t,isLoadingTimeSlots:r})=>{if(r)return;let[n,i]=a()(e.attendees,e=>"DistributionAssignee"===e.type&&e.userIds.length>1),o=s()(i.flatMap(e=>"DistributionAssignee"===e.type?e.userIds:[e.userId])),u=t.flatMap(e=>"ExternalAttendeeId"===e.id.type?e.id.email:[]),d=n.length;return{assigneeIds:o,unknownAssigneesCount:u.length+d}}},48659:(e,t,r)=>{r.d(t,{AX:()=>o,Cn:()=>s,UV:()=>i,Uo:()=>n,h6:()=>a});let n=(e,t=[])=>{let r=e.get("meetingTypeId");return r||(1===t.length?t[0]:void 0)},i=({searchParams:e,meetingType:t,smartParameters:r})=>{let n=u(t);if(!n)return;let i=n.reduce((t,n)=>{let i=s({key:n,searchParams:e,smartParameters:r});return i&&(t[n]=i),t},{});if(Object.keys(i).length>0)return{values:i}},a=e=>e?.list?.reduce((e,t)=>("DataField"===t.key.type&&(e[t.key.key]=t.value),e),{}),o=({formValues:e,dfRefSlugMap:t})=>{let r=Object.keys(e).reduce((t,r)=>(e[r]&&(t[r]=e[r]),t),{});return Object.keys(t).reduce((e,n)=>{let i=t?.[n];return i&&r[i]?e[n]=r[i]:r[n]&&(e[n]=r[n]),e},r)},s=({key:e,searchParams:t,smartParameters:r})=>{let n=r?.[e];return t.get(n??"")??t.get(e)},u=e=>e?.guestForm.type==="DataFields"?e?.guestForm.fields.map(e=>e.reference):e?.guestForm.type==="Mixed"?e.guestForm.items.map(e=>"Question"===e.type?e.id:e.reference):void 0},54583:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var n=r(95155),i=r(55125),a=r(26173),o=r(75011),s=r(69567),u=r(12115),d=r(76106);let l=({error:e})=>{let t=(0,d.t)(),{onClose:r}=(0,o.K)();return((0,u.useEffect)(()=>{"errorMessage"in e&&(0,s.BI)("ERROR",{message:e?.errorMessage})},[]),t)?(0,n.jsx)(o.b,{children:(0,n.jsx)(i.A,{closeModal:r,isError:!0,children:(0,n.jsx)(a.M,{error:e})})}):(0,n.jsx)(a.M,{error:e})}},55125:(e,t,r)=>{r.d(t,{A:()=>I});var n=r(95155);r(12115);var i=r(10720),a=r(35695),o=r(38140),s=r(62177),u=r(69567),d=r(59540),l=r(75011),c=r(76106),g=r(14693),y=r(64553),h=r(23105),p=r(87890);let m=(0,h.I4)(p.az)`
  margin: 0 auto;
  border: 0;
  border-radius: ${e=>e.theme.radii[8]};
`,f=(0,h.I4)(p.so)`
  border-radius: ${e=>e.theme.radii[8]};
  top: 50%;
  transform: translateY(-50%);
  position: relative;
  width: 100%;
  flex-direction: column;

  @media (min-width: ${e=>e.theme.breakpoints[1]}) and (max-width: ${e=>e.theme.breakpoints[2]}) {
    width: fit-content;
    margin: 0 auto;
    flex-direction: row;
  }
  @media (min-width: ${e=>e.theme.breakpoints[2]}) {
    width: fit-content;
    margin: 0 auto;
    flex-direction: row;
  }
`,b=({ref:e,closeModal:t,isError:r,children:h})=>{let p=(0,a.useSearchParams)(),b=(0,g.de)(),I=(0,a.useParams)(),{onClose:v}=(0,l.K)(),{data:C}=(0,y.SX)({routingId:I.routingId,tenantId:b}),w=(0,i.l)(),k=(0,a.usePathname)(),R=I.routingId&&C?.type==="PublicRoutingInfoForInProgress"&&"RoutedWithoutCalendar"!==C.launchResponse.type,F=(0,c.t)(),P=r||R,j=(0,d.m)({schedulingBranding:w,pathname:k}),O=P?j:"transparent";return F?(0,n.jsx)(o.a,{isOpen:!0,portalClassName:"Concierge-Modal-Portal",shouldCloseOnEsc:"true"===p.get("closeOnOutside"),shouldCloseOnOverlayClick:"true"===p.get("closeOnOutside"),overlayStyles:{background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(30px)"},onRequestClose:t||v||u.jg,ariaHideApp:!1,contentStyles:{width:"fit-content",minWidth:"370px",height:"90vh",maxHeight:"90vh"},children:(0,n.jsxs)(f,{ref:e,bg:O,padding:2,boxShadow:P?"border/popover":void 0,"data-test-id":"booking-modal",minWidth:"370px",minHeight:"36vh",width:"fit-content",children:[P&&(0,n.jsx)(s.s,{onClose:t||v||u.jg}),(0,n.jsx)(m,{width:"100%",minHeight:"30vh",height:"fit-content",bg:O,zIndex:-1,className:"chilipiper-frame",children:h})]})}):(0,n.jsx)(n.Fragment,{children:h})};b.displayName="ConciergeRouterModal";let I=b},62971:(e,t,r)=>{r.d(t,{G:()=>a});var n=r(12115),i=r(32056);let a=()=>(0,n.useCallback)(e=>{let t={...(0,i.YB)()};e?t["x-routing-id"]=e:delete t["x-routing-id"],(0,i.cr)(t)},[])},64553:(e,t,r)=>{r.d(t,{CU:()=>d,Aj:()=>p,bX:()=>f,Ds:()=>m,ih:()=>h,vu:()=>g,f6:()=>y,_t:()=>u,SX:()=>c,jw:()=>l,zf:()=>b});var n=r(35771),i=r(81717),a=r(52020),o=r(28755),s=r(5041);let u=e=>(0,o.I)((({routerSlug:e,tenantId:t})=>(0,i.j)({queryKey:["concierge","router",t,e],queryFn:t&&e?()=>n.us.settingsBySlug(t,e):a.hT,retry:2}))(e)),d=({routerSlug:e,tenantId:t})=>(0,i.j)({queryKey:["concierge","js-options",t,e],queryFn:t&&e?()=>Promise.resolve(null):a.hT,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),l=e=>(0,o.I)(d(e)),c=e=>(0,o.I)((({routingId:e,tenantId:t})=>(0,i.j)({queryKey:["concierge","routing",t,e],queryFn:e&&t?()=>n.us.getPublicRoutingInfo(t,e,{cache:"no-store"}):a.hT,enabled:!!(e&&t)}))(e)),g=e=>(0,o.I)((({routingId:e,tenantId:t,flowId:r,redirectType:o})=>(0,i.j)({queryKey:["concierge","live-status",t,e,r],queryFn:r?()=>n.us.getLiveFlowState(t,r):a.hT,refetchInterval:e=>(e.state.data?.status==="LookingForSource"||"OnHangUp"===o&&e.state.data?.status==="PartiesConnected")&&200}))(e)),y=e=>(0,o.I)((({tenantId:e,routerSlug:t,email:r,triggerType:o="ThirdPartyForm"})=>(0,i.j)({queryKey:["concierge","enrich-data",e,t,r,o],queryFn:r?()=>n.us.preLaunchOperationsByRouterSlug(e,t,{email:r,"trigger-type":o,"with-values":!0},{cache:"force-cache"}):a.hT}))(e)),h=({tenantId:e,routerSlug:t})=>(0,s.n)({mutationFn:({payload:r})=>n.us.launchRouting(e,t,r),retry:3,retryDelay:e=>500*e}),p=()=>(0,s.n)({mutationFn:({phoneNumber:e,tenantId:t})=>n.us.cfLiveCheckGuestNumber(t,e)}),m=()=>(0,s.n)({mutationFn:({routingId:e,tenantId:t})=>n.us.cfLiveChooseScheduling(t,e,{})}),f=()=>(0,s.n)({mutationFn:({routingId:e,tenantId:t,data:r})=>n.us.cfLiveChooseCall(t,e,r)}),b=()=>(0,s.n)({mutationFn:({routingId:e,tenantId:t,data:r})=>n.us.scheduleMeeting(t,e,r)})},66621:(e,t,r)=>{r.d(t,{H:()=>d,s:()=>l});var n=r(35771);let i=async(e,t)=>n.oy.getDataFields(e,{ref:t});var a=r(81717),o=r(52020),s=r(28755),u=r(5041);let d=e=>(0,s.I)((({tenantId:e,ref:t})=>(0,a.j)({queryKey:[e,"data-fields",t?.join("-")],queryFn:e&&t?.length?()=>i(e,t):o.hT,enabled:!!(e&&t?.length),placeholderData:o.rX}))(e)),l=()=>(0,u.n)({mutationFn:e=>n.oy.submitGuestActivitySync(e.tenantId,e.guestId,{event:e.payload})})},75011:(e,t,r)=>{r.d(t,{K:()=>l,b:()=>d});var n=r(95155),i=r(69567),a=r(31431),o=r.n(a),s=r(12115);let u=(0,s.createContext)(void 0),d=({children:e})=>{let t=(0,s.useRef)(i.jg),[r,a]=(0,s.useState)(!0),o=(0,s.useCallback)(e=>{t.current=e},[t]),d=(0,s.useCallback)(()=>{t.current(),a(!1)},[t]),l=(0,s.useMemo)(()=>({onClose:d,setOnCloseModal:o}),[o,d]);return r?(0,n.jsx)(u.Provider,{value:l,children:e}):null},l=()=>{let e=(0,s.use)(u);if(!e)return{onClose:i.jg,setOnCloseModal:o()};let{setOnCloseModal:t,onClose:r}=e;return{setOnCloseModal:t,onClose:r}}},76106:(e,t,r)=>{r.d(t,{t:()=>i});var n=r(35695);let i=()=>{let e=(0,n.useSearchParams)();return!e.has("domElement")&&e.has("trigger")&&!["RestAPI","RouterLink"].includes(e.get("trigger"))||"true"===e.get("concierge")}},78226:(e,t,r)=>{r.d(t,{V:()=>w});var n=r(14693),i=r(35695),a=r(64553),o=r(3673),s=r(66621),u=r(12115),d=r(89443),l=r(7132),c=r(44273),g=r(83058),y=r(69567),h=r(48659),p=r(26715),m=r(28539);let f=(e,t)=>{if(!t)return[];let r=(0,m.r)(t,e);return"ThirdPartyForm"===e?r.map(e=>e.dataFieldRef):"RouterLink"===e||"InAppButton"===e?r.map(e=>e.dataField):[]},b="event_",I=(e,t,r={})=>{if(void 0!==t[e]&&"event"!==e)return t[e];let n=Object.keys(r).find(t=>t.toLocaleLowerCase()===e.toLocaleLowerCase());return n?r[n]:void 0};var v=r(33903),C=r(62971);let w=({trigger:e="ThirdPartyForm"})=>{let t=(0,C.G)(),r=(0,p.jE)(),[w,k]=(0,u.useTransition)(),R=(0,n.de)(),F=(0,o.u)(),{routerSlug:P}=(0,i.useParams)(),{timezone:j}=(0,d.BF)(),{mutate:O,error:S,isPending:L,isSuccess:T}=(0,a.ih)({tenantId:R,routerSlug:P}),{data:E,isLoading:M,error:A}=(0,a._t)({tenantId:R,routerSlug:P}),{data:x}=(0,a.jw)({tenantId:R,routerSlug:P}),D=(0,a.CU)({tenantId:R,routerSlug:P}).queryKey,_=f(e,E?.formMapping),{data:q,isLoading:B}=(({fieldRefs:e=[]})=>{let t=(0,n.de)(),{data:r,isLoading:i}=(0,g.QJ)({tenantId:t,refs:e});return{data:(0,h.h6)(r)||{},isLoading:i}})({fieldRefs:_}),{data:K,isLoading:U}=(0,s.H)({tenantId:R,ref:_}),$=(0,i.useRouter)(),N=(0,c.cb)();(0,u.useEffect)(()=>{t()},[]);let G=(0,u.useCallback)(e=>{N({variant:"caution","data-test-id":"launch-routing-error",title:"Error while routing. Please, try again."}),console.error(e)},[N]),H=(0,u.useCallback)(()=>{if(!x)return;if(E&&!E.acceptsRouting){(0,y.BI)("ERROR",{response:"The concierge router is not active"}),(0,y.BI)("CLOSED");return}(0,y.BI)("ROUTING");let n=((e,t)=>t?.elements?.reduce((t,r)=>{let n=r.reference;return e[n]&&(r?.dataType.type==="Number"?t[n]=String(Number(e[n])):r?.dataType.type==="Phone"?t[n]=String(e[n]).replace(/^[ ]/,"+").replace(/([^0-9+])/g,""):r?.dataType.type==="Email"?t[n]=String(e[n]).replaceAll(" ","+"):t[n]=String(e[n])),t},{})||{})((({jsOptions:e,formMapping:t,trigger:r,dfRefSlugMap:n={}})=>{if("ThirdPartyForm"!==r){let i=f(r,t),a=(0,h.AX)({dfRefSlugMap:n,formValues:e});return Object.keys(a).filter(e=>i.some(t=>t.toLowerCase()===e.toLowerCase())).reduce((e,t)=>((a[t]||a[t.toLowerCase()])&&(e[t]=a[t]||a[t.toLowerCase()]),e),{})}let i=(0,h.AX)({dfRefSlugMap:n,formValues:e}),a=Object.keys(i);return(0,m.r)(t,r).reduce((e,t)=>{let r=a.find(e=>e.toLowerCase()===t.name.toLowerCase()||e.toLowerCase()===t.dataFieldRef.toLowerCase());return r&&i[r]&&(e[t.dataFieldRef]=i[r]),e},{})||{}})({jsOptions:x,formMapping:E?.formMapping,trigger:e,dfRefSlugMap:q}),K),i=(e=>{let t=b.length;return Object.keys(e).reduce((r,n)=>(e[n]&&n.startsWith(b)&&(r[n.substring(t)]=e[n]),r),{})})(F),a=((e,t={})=>{if(Object.keys(e).some(t=>void 0!==e[t])){let r=I("campaignId",e,t),n=I("status",e,t);return{sfAccountId:I("accountId",e,t),sfCaseId:I("caseId",e,t),sfCustomObjectId:I("objectId",e,t),sfOpportunityId:I("opportunityId",e,t),sfEventRelation:"true"===I("disableRelation",e,t)?{type:"RelationDisabled"}:void 0,sfExtraEventFields:Object.keys(e.event??{}).length?e.event:void 0,sfCampaign:r&&n?{status:n,campaignId:r}:void 0}}})({...x,event:x.event||i},F),o=F.assignee?{type:"AssigneeSlug",userSlug:F.assignee}:F.assigneeCrmId?{type:"AssigneeCrmId",crmId:F.assigneeCrmId}:void 0,s={routingId:x.routingId,guestTimezone:j,bookerSlug:x.by,sourceUrl:x.sourceUrl,crmExplicits:a,explicitAssignee:o,trigger:e},u=new URLSearchParams((({jsOptions:e,formMapping:t,trigger:r,dfRefSlugMap:n})=>{let i=Object.values(n),a=t=>Object.keys(e).filter(e=>t?.includes(e)||i.includes(e)).reduce((t,r)=>(t[r]=e[r],t),{});return a("ThirdPartyForm"===r?(0,m.r)(t,r).map(e=>e.name):f(r,t))})({jsOptions:x,formMapping:E?.formMapping,trigger:e,dfRefSlugMap:q})).toString(),d=e=>(r.invalidateQueries({queryKey:D}),t(e.routingId),(0,y.BI)("ROUTED",{routingId:e.routingId}),(0,y.BI)("STOPPED_LISTENING_FORM_DATA_UPDATE"),$.replace((0,v.Jp)({...x,routingId:e.routingId,routerSlug:P,fieldParams:u,guestEmail:n[l.gk]}))),c=e=>{r.invalidateQueries({queryKey:D}),G(e)};return x.id?O({payload:{...s,trigger:"RouterLink",type:"SmartParamsGenericIdRequest",fields:n,id:x.id.replaceAll(" ","+")}},{onError:c,onSuccess:d}):O({payload:{...s,type:"LaunchRouteRequestV2",fields:n}},{onError:c,onSuccess:d})},[O,F,e,j,E?.formMapping,K,G,$,q,x]),X=(0,u.useMemo)(()=>!A&&(U||M||B),[U,M,B,A]),Q=(0,u.useMemo)(()=>L||T,[L,T]);return(0,u.useEffect)(()=>{if(!w&&x&&!X&&!Q&&!S){if(A){(0,y.BI)("ERROR",{response:"Error while loading the concierge router. Please, check if the router name is correct"}),(0,y.BI)("CLOSED");return}k(()=>{H()})}},[w,x,X,Q,A]),{launchRouting:(0,u.useCallback)(e=>{x||r.setQueryData(D,e)},[x]),error:S,isPending:X||L||T}}}}]);